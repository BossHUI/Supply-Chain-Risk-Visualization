# 风险报告可视化工具

一个用于解析和可视化风险评估报告的Python工具，能够从Markdown格式的风险报告中提取结构化数据，并生成交互式的HTML可视化报告。

## 功能特性

- 📊 **报告解析**：自动解析 `research_assessment_manager_report.md` 格式的风险报告
- 🗺️ **地理位置处理**：智能识别和规范化地理位置信息，支持地理位置层级关系
- 📈 **数据可视化**：生成包含地图、统计图表和详细信息的交互式HTML报告
- 🔄 **批量处理**：支持批量处理多个报告文件夹
- 📑 **索引生成**：自动生成报告索引页面，方便浏览和选择

## 安装

无需安装，直接使用Python运行脚本即可。

```bash
python main_simple.py
```

## 使用方法

### 单个报告处理

处理单个报告文件：

```bash
python main_simple.py <报告文件路径>
```

示例：
```bash
python main_simple.py reports/2026-01-16_16-08-49/research_assessment_manager_report.md
```

### 批量处理

批量处理 `reports` 目录下的所有报告：

```bash
python main_simple.py --batch
```

批量处理会：
1. 遍历 `reports` 目录下的所有子文件夹
2. 查找每个文件夹中的 `research_assessment_manager_report.md` 文件
3. 为每个报告生成对应的 `report_visualization.html` 文件
4. 在项目根目录生成 `index.html` 索引页面

## 输出文件

### 单个报告输出

处理单个报告后，会在报告文件同目录下生成：
- `report_visualization.html`：交互式可视化报告

### 批量处理输出

批量处理后会生成：
- 每个报告文件夹中的 `report_visualization.html`
- 项目根目录的 `index.html`：报告索引页面，包含所有报告的列表和统计信息

## 报告解析内容

脚本会从报告中提取以下信息：

### 基本信息
- **标题**：报告标题
- **作者**：报告作者
- **日期**：报告日期

### 风险数据
- **风险清单**：包含序号、风险名称、风险类别、风险等级、风险描述、地理位置
- **风险详情**：每个风险的详细信息
  - 触发条件
  - 风险表现
  - 风险等级
  - 判断依据
  - 风险应对措施
- **风险速览**：风险摘要信息

### 地理位置信息
- 自动识别和规范化地理位置名称
- 支持地理位置层级关系（如：塞梅鲁 → 东爪哇 → 印度尼西亚）
- 过滤冗余的地理位置信息
- 支持地理位置坐标映射

## 地理位置处理特性

### 规范化规则
- 缩写统一：`印尼` → `印度尼西亚`，`欧盟` → `欧洲`
- 过滤模糊地区：自动过滤 `中部`、`沿海地区`、`国内`、`海外` 等模糊描述
- 过滤公司名称：自动过滤 `广汽`、`本田`、`安世` 等公司名称

### 层级关系处理
- 自动识别地理位置之间的层级关系（如：`塞梅鲁位于东爪哇省`）
- 当同时存在具体地区和所属国家时，优先保留具体地区
- 支持基于坐标距离推断地理位置关系

### 支持的地理位置
内置支持以下地理位置及其坐标：
- 国家：荷兰、中国、日本、美国、德国、法国、英国、澳大利亚、韩国、印度、越南、印度尼西亚等
- 地区：福岛、鹿儿岛、东爪哇、塞梅鲁、东莞、莱茵河等

## HTML报告特性

生成的HTML报告包含：

1. **报告概览**
   - 报告标题、作者、日期
   - 风险统计信息

2. **风险清单表格**
   - 可排序的表格
   - 显示风险序号、名称、类别、等级、描述、地理位置

3. **地图可视化**
   - 基于Leaflet的交互式地图
   - 风险位置标记
   - 点击标记查看风险详情

4. **风险详情展示**
   - 每个风险的完整信息
   - 触发条件、风险表现、风险等级、判断依据、风险应对

5. **统计图表**
   - 风险等级分布
   - 风险类别分布
   - 地理位置分布

## 项目结构

```
.
├── main_simple.py              # 主脚本文件
├── index.html                  # 报告索引页面（批量处理时生成）
├── coordinate_cache.json       # 坐标缓存文件（如果使用）
└── reports/                     # 报告目录
    ├── 2026-01-14_20-23-57/
    │   ├── research_assessment_manager_report.md
    │   └── report_visualization.html
    ├── 2026-01-15_17-23-59/
    │   └── ...
    └── ...
```


## 注意事项

1. **报告格式要求**：脚本专门针对 `research_assessment_manager_report.md` 格式设计，其他格式可能无法正确解析。

2. **地理位置识别**：地理位置识别基于关键词匹配，如果报告中使用了非常规的地理位置名称，可能无法识别。

3. **坐标缓存**：脚本支持坐标缓存功能（通过 `coordinate_cache.json`），可以缓存已查询的地理位置坐标，提高处理速度。

4. **文件编码**：确保报告文件使用 UTF-8 编码，否则可能出现乱码。

## 开发说明

### 扩展地理位置支持

要添加新的地理位置支持，需要：

1. 在 `_get_all_location_coords()` 方法中添加坐标：
```python
'新地点': (纬度, 经度),
```

2. 在 `extract_location_from_text()` 方法的 `location_keywords` 列表中添加关键词

3. 如果需要建立层级关系，在 `filter_redundant_locations()` 方法中添加关系映射

### 自定义HTML模板

HTML报告模板在 `generate_html_report()` 函数中定义，可以根据需要修改样式和布局。

## 许可证

本项目为内部工具，仅供实验室使用。
